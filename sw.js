"use strict";const CACHE_NAME="ethno-explorer-v3-20251220",PRECACHE_URLS=["/","/index.html","/bundle.js","/manifest.json"],RUNTIME_CACHE="ethno-runtime-v1";self.addEventListener("install",e=>{e.waitUntil(caches.open(CACHE_NAME).then(e=>e.addAll(PRECACHE_URLS)).then(()=>self.skipWaiting()))}),self.addEventListener("activate",e=>{e.waitUntil(caches.keys().then(e=>Promise.all(e.filter(e=>e.startsWith("ethno-")).map(e=>e!==CACHE_NAME&&e!==RUNTIME_CACHE?caches.delete(e):void 0))).then(()=>self.clients.claim()))}),self.addEventListener("fetch",e=>{const{request:t}=e;new URL(t.url),"navigate"!==t.mode?t.url.match(/\.(wav|ogg|flac|mp3|m4a|weba|webm)$/i)||t.url.match(/\.(png|jpg|jpeg|svg|gif|webp)$/i)?e.respondWith(caches.open(RUNTIME_CACHE).then(e=>e.match(t).then(n=>n||fetch(t).then(n=>(n&&200===n.status&&e.put(t,n.clone()),n))))):e.respondWith(caches.match(t).then(e=>e||fetch(t).then(e=>{if("GET"===t.method&&e&&200===e.status&&"basic"===e.type){const n=e.clone();caches.open(CACHE_NAME).then(e=>e.put(t,n))}return e}))):e.respondWith(fetch(t).then(e=>{const t=e.clone();return caches.open(CACHE_NAME).then(e=>e.put("/",t)),e}).catch(()=>caches.match("/")))});